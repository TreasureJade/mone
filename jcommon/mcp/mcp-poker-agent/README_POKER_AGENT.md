# 德州扑克 AI Agent

一个专业的德州扑克策略分析和决策辅助系统，通过精确的数学计算、蒙特卡洛模拟和对手建模来帮助玩家做出最优决策。

## 核心功能

### 1. 胜率计算 (Win Rate Calculator)
- **蒙特卡洛模拟**：通过10,000次随机模拟计算精确胜率
- **支持所有阶段**：翻牌前、翻牌、转牌、河牌
- **多对手支持**：可同时对抗1-9名对手
- **实时牌型分析**：显示当前最佳牌型和牌力强度

### 2. 策略决策系统 (Strategy Decision)
- **GTO策略基础**：基于博弈论最优策略
- **位置感知**：根据前位、中位、后位、盲注位调整策略
- **动态决策**：考虑底池大小、筹码深度、对手激进度
- **多阶段优化**：针对翻牌前、翻牌后不同阶段的专门策略
- **期望收益计算**：基于EV做出数学上最优的决策

### 3. 对手建模 (Opponent Modeling)
- **玩家类型识别**：紧凶型、紧弱型、松凶型、松弱型
- **统计数据跟踪**：VPIP（入池率）、PFR（翻牌前加注率）、激进度
- **行为模式分析**：3-bet频率、持续下注反应、Check-Raise倾向
- **诈唬概率预测**：根据对手类型和阶段预测诈唬可能性
- **针对性策略建议**：为每种对手类型提供最优对抗策略

## 核心组件

### 模型类 (Model)
- **Card**: 扑克牌类，支持花色和点数
- **HandRank**: 牌型等级，包含10种德州扑克牌型

### 工具类 (Utility)
- **HandEvaluator**: 牌型评估器，识别和比较牌型强度
- **WinRateCalculator**: 胜率计算器，蒙特卡洛模拟
- **PokerStrategy**: 策略决策引擎
- **OpponentModel**: 对手建模系统

### Agent工具 (Tools)
1. **CalculateWinRateTool**: 计算胜率
2. **MakeDecisionTool**: 制定策略决策  
3. **AnalyzeOpponentTool**: 分析对手特征

## 使用示例

### 1. 计算胜率

```json
{
  "hole_cards": "As,Kh",
  "community_cards": "Jd,Tc,9s",
  "num_opponents": 2
}
```

返回结果：
```json
{
  "success": true,
  "win_rate": "65.30%",
  "tie_rate": "2.10%",
  "lose_rate": "32.60%",
  "current_hand": "高牌 [14, 13, 11, 10, 9]",
  "hand_strength": "128.50"
}
```

### 2. 策略决策

```json
{
  "hole_cards": "Qh,Qs",
  "community_cards": "Jd,Tc,9s",
  "stage": "FLOP",
  "position": "LATE",
  "num_opponents": 3,
  "pot_size": 150,
  "current_bet": 50,
  "stack_size": 1000,
  "is_aggressive": false
}
```

返回结果：
```json
{
  "success": true,
  "action": "加注",
  "bet_size": 2.5,
  "win_rate": "72.30%",
  "expected_value": "85.50",
  "confidence": "90.00%",
  "reasoning": "持有强牌（胜率72.30%），加注获取更多价值"
}
```

### 3. 对手分析

查询对手信息：
```json
{
  "opponent_id": "player_1",
  "operation": "query",
  "stage": "FLOP"
}
```

记录对手行为：
```json
{
  "opponent_id": "player_1",
  "operation": "record_action",
  "action": "RAISE",
  "is_pre_flop": true
}
```

## 策略特点

### 翻牌前策略
- **强牌积极**: AA, KK, QQ, AK 等顶级手牌主动加注
- **位置优势**: 后位可以更宽松地入池
- **筹码管理**: 根据筹码深度调整加注大小

### 翻牌后策略
- **价值下注**: 强牌时获取最大价值
- **听牌计算**: 根据出牌数(Outs)和底池成败比决策
- **保护手牌**: 中等牌力时防止对手免费看牌
- **诈唬时机**: 后位且对手被动时可以尝试诈唬

### 对手适应
- **紧弱型**: 频繁诈唬，尊重他们的加注
- **紧凶型**: 避免对抗，好牌时慢打诱导
- **松弱型**: 价值下注榨取，避免诈唬
- **松凶型**: 需要更好的牌，利用陷阱玩法

## 数学基础

### 关键概念
- **底池成败比 (Pot Odds)**: 需要跟注的金额 / (底池 + 跟注金额)
- **出牌数 (Outs)**: 能让你赢的剩余牌数
- **期望收益 (EV)**: (胜率 × 赢的金额) + (输率 × 输的金额)

### 计算公式
- **改进概率**: 
  - 1张牌: Outs / 46
  - 2张牌: Outs × 4%
- **决策准则**: 胜率 > 底池成败比 → 跟注

## 牌型等级

1. **皇家同花顺** (Royal Flush): 10-J-Q-K-A 同花色
2. **同花顺** (Straight Flush): 5张连续同花色
3. **四条** (Four of a Kind): 4张相同点数
4. **葫芦** (Full House): 3张 + 2张
5. **同花** (Flush): 5张同花色
6. **顺子** (Straight): 5张连续点数
7. **三条** (Three of a Kind): 3张相同点数
8. **两对** (Two Pair): 2对
9. **一对** (One Pair): 1对
10. **高牌** (High Card): 最高单牌

## 技术实现

### 胜率计算算法
使用蒙特卡洛方法：
1. 从剩余牌库中随机抽取补全公共牌
2. 为每个对手随机发2张手牌
3. 比较所有玩家的最佳5张牌组合
4. 重复10,000次统计胜率

### 牌型评估算法
1. 生成所有5张牌的组合（从7张中选5张）
2. 对每个组合检查所有牌型（从高到低）
3. 返回最强的牌型组合

### 策略决策流程
```
输入牌局信息 
    ↓
计算胜率和牌力
    ↓
评估底池成败比
    ↓
分析位置和阶段
    ↓
考虑对手特征
    ↓
生成决策建议
```

## 配置说明

### application.properties
```properties
mcp.agent.name=poker-agent
server.port=8080
```

## 启动方式

```bash
# 编译
mvn clean install

# 运行
java -jar target/mcp-poker-agent-*.jar
```

## 优势特点

1. **数学精确性**: 基于蒙特卡洛模拟的精确胜率计算
2. **策略科学性**: 遵循GTO理论和EV最大化原则
3. **自适应能力**: 根据对手类型动态调整策略
4. **实时分析**: 快速给出决策建议
5. **可扩展性**: 易于添加新的策略模块

## 适用场景

- 在线德州扑克辅助决策
- 牌局复盘分析
- 策略学习和训练
- 对手建模和研究

## 注意事项

- 本工具仅用于学习和研究目的
- 实际游戏中需结合具体情况灵活运用
- 建议配合实战经验使用，不要完全依赖工具
- 遵守游戏平台的使用规则

## 未来改进方向

1. 增加范围平衡 (Range Balancing)
2. 实现ICM计算（锦标赛筹码模型）
3. 添加深度学习模型提升准确性
4. 支持更多变种玩法
5. 增加可视化界面
6. 实时数据库存储对手信息

## 作者

Poker Agent Team - 2025

## 许可证

本项目遵循项目根目录的许可证协议
